{% extends "base.html" %}

{% block title %}
	{{ _("Configure Automatic Releases") }} - {{ package.title }}
{% endblock %}

{% block content %}
	<h1>{{ _("Configure Automatic Releases") }}</h1>

	<p>
		{{ _("When you push a change to your Git repository, ContentDB can create a new release automatically.") }}
	</p>

	<p>
		{{ _("ContentDB will poll your Git repository at 2am UTC every day, if your package is approved.") }}
		{{ _("You should consider using webhooks or the API for faster releases.") }}
	</p>

	{% if package.checkPerm(current_user, "APPROVE_RELEASE") and package.getIsOnGitHub() %}
		<p class="alert alert-info mb-4">
			<a class="float-right btn btn-sm btn-info" href="{{ url_for('flatpage', path='help/release_webhooks') }}">{{ _("Learn more") }}</a>
			<a class="float-right btn btn-sm btn-info mr-2" href="{{ url_for('github.setup_webhook', pid=package.id) }}">{{ _("Setup webhook") }}</a>
			<i class="fas fa-info mr-2"></i>

			{{ _("You can create releases faster by using a webhook.") }}
		</p>
	{% endif %}

	{% from "macros/forms.html" import render_field, render_submit_field, render_checkbox_field %}
	<form method="POST" action="">
		{{ form.hidden_tag() }}

		{{ render_field(form.trigger, class_="mt-5") }}

		<p class="text-warning mb-4">
			<span class="fas fa-exclamation-triangle mr-2"></span>

			{{ _("The new tag trigger isn't supported yet.") }}
			{{ _("In the meantime, you can use webhooks to create releases on tag events.") }}
		</p>


		{{ render_field(form.ref, placeholder="Leave blank to use default branch",
				pattern="[A-Za-z0-9/._-]+") }}
		{{ render_field(form.action) }}

		<p class="mt-5">
			{{ render_submit_field(form.submit) }}
			{{ render_submit_field(form.disable, class_="btn btn-secondary ml-2") }}
		</p>
	</form>
{% endblock %}
